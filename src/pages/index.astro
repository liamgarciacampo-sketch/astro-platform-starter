---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Página de Marcelo">
  <div style="min-height:100vh;display:flex;align-items:center;justify-content:center;background:#f3f4f6;padding:16px;">
    <div style="width:100%;max-width:600px;background:white;border-radius:20px;box-shadow:0 6px 20px rgba(0,0,0,.08);padding:24px;font-family:system-ui,Roboto,Arial;">
      <h1 style="font-size:24px;font-weight:700;margin-bottom:8px;">Página de Marcelo</h1>
      <p style="color:#555;margin-bottom:16px;">Sube tu tarea (PDF, DOCX, PPTX, JPG, PNG · máx 25 MB)</p>

      <input id="fileInput" type="file" accept=".pdf,.docx,.pptx,.png,.jpg,.jpeg" style="margin-bottom:12px;"/><br/>
      <button id="uploadBtn" style="width:100%;padding:10px 14px;background:#2563eb;color:white;border:0;border-radius:10px;font-weight:600;cursor:pointer;">Subir archivo</button>

      <div id="progress" style="height:8px;background:#ddd;border-radius:999px;margin-top:10px;overflow:hidden;">
        <div id="bar" style="height:8px;width:0;background:#3b82f6;transition:width .2s;"></div>
      </div>
      <p id="status" style="font-size:14px;color:#555;margin-top:8px;">Esperando archivo…</p>
      <p id="link" style="word-break:break-all;margin-top:8px;"></p>
    </div>
  </div>

  <script defer src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.13.1/firebase-storage-compat.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const firebaseConfig = {
        apiKey: "TU_API_KEY",
        authDomain: "TU_AUTH_DOMAIN",
        projectId: "TU_PROJECT_ID",
        storageBucket: "TU_STORAGE_BUCKET",
        messagingSenderId: "TU_SENDER_ID",
        appId: "TU_APP_ID"
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const storage = firebase.storage();
      await auth.signInAnonymously();

      const fileInput = document.getElementById("fileInput");
      const uploadBtn = document.getElementById("uploadBtn");
      const progress = document.getElementById("bar");
      const status = document.getElementById("status");
      const link = document.getElementById("link");

      uploadBtn.onclick = () => {
        const file = fileInput.files[0];
        if (!file) return alert("Selecciona un archivo primero.");
        const ref = storage.ref().child("tareas/" + Date.now() + "-" + file.name);
        const task = ref.put(file);
        status.textContent = "Subiendo…";

        task.on("state_changed", snap => {
          const pct = (snap.bytesTransferred / snap.totalBytes) * 100;
          progress.style.width = pct + "%";
        }, err => {
          status.textContent = "Error: " + err.message;
        }, async () => {
          const url = await ref.getDownloadURL();
          status.textContent = "✅ Subida completa";
          link.innerHTML = 'Enlace: <a href="' + url + '" target="_blank">' + url + "</a>";
          progress.style.width = "0%";
          fileInput.value = "";
        });
      };
    });
  </script>
</Layout>
